import{h as o,i as c,j as n,L as e,n as m}from"./vidstack-4faeced4.js";import{a as g,N as p,$ as b,e as f,o as d,l as h,D as l,a0 as y,Q as k,n as $,h as _}from"./vidstack-4f9ca33d.js";class u{constructor(t){this.N=t}D(){g(this.jb)&&this.kb()}E(){p(this.jb)&&window.cancelAnimationFrame(this.jb),this.jb=void 0}kb(){this.jb=window.requestAnimationFrame(()=>{g(this.jb)||(this.N(),this.kb())})}}class T{constructor(t,i){this.da=b(),this.ba=!1,this.ea=!1,this.fa=!1,this.ca=new u(this.ka.bind(this)),this.ja=void 0,this.Ha=void 0,this.ga=t,this.l=i,this.la(),f(this.ma.bind(this)),d(this.Q.bind(this))}get g(){return this.ga.media}get _(){return this.l.delegate}Q(){this.ea=!1,this.fa=!1,this.ca.E(),this.da.empty()}ka(){const t=this.ga.currentTime;this.l.$state.currentTime()!==t&&this.aa(t)}la(){this.$("loadstart",this.K),this.$("abort",this.ia),this.$("emptied",this.na),this.$("error",this.p)}oa(){this.ea||(this.da.add(this.$("loadeddata",this.pa),this.$("loadedmetadata",this.qa),this.$("canplay",this.ra),this.$("canplaythrough",this.sa),this.$("durationchange",this.ta),this.$("play",this.ua),this.$("progress",this.va),this.$("stalled",this.wa),this.$("suspend",this.xa)),this.ea=!0)}ya(){this.fa||(this.da.add(this.$("pause",this.za),this.$("playing",this.Aa),this.$("ratechange",this.Ba),this.$("seeked",this.Ca),this.$("seeking",this.Da),this.$("ended",this.Ea),this.$("volumechange",this.Fa),this.$("waiting",this.Ga)),this.fa=!0)}$(t,i){return h(this.g,t,i.bind(this))}Ia(t){}aa(t,i){this._.f("time-update",{detail:{currentTime:Math.min(t,this.l.$state.seekableEnd()),played:this.g.played},trigger:i})}K(t){if(this.g.networkState===3){this.ia(t);return}this.oa(),this._.f("load-start",{trigger:t})}ia(t){this._.f("abort",{trigger:t})}na(){this._.f("emptied",{trigger:event})}pa(t){this._.f("loaded-data",{trigger:t})}qa(t){this.ya(),this._.f("volume-change",{detail:{volume:this.g.volume,muted:this.g.muted}}),this._.f("loaded-metadata",{trigger:t}),o&&c(this.l.$state.source())&&this._.Ja(this.ha(),t)}ha(){return{duration:this.g.duration,buffered:this.g.buffered,seekable:this.g.seekable}}ua(t){this.l.$state.canPlay&&this._.f("play",{trigger:t})}za(t){this.g.readyState===1&&!this.ba||(this.ba=!1,this.ca.E(),this._.f("pause",{trigger:t}))}ra(t){this._.Ja(this.ha(),t)}sa(t){this.l.$state.started()||this._.f("can-play-through",{trigger:t,detail:this.ha()})}Aa(t){this.ba=!1,this._.f("playing",{trigger:t}),this.ca.D()}wa(t){this._.f("stalled",{trigger:t}),this.g.readyState<3&&(this.ba=!0,this._.f("waiting",{trigger:t}))}Ga(t){this.g.readyState<3&&(this.ba=!0,this._.f("waiting",{trigger:t}))}Ea(t){this.ca.E(),this.aa(this.g.duration,t),this._.f("end",{trigger:t}),this.l.$state.loop()?this.Ka():this._.f("ended",{trigger:t})}ma(){this.l.$state.paused()&&h(this.g,"timeupdate",this.La.bind(this))}La(t){this.aa(this.g.currentTime,t)}ta(t){this.l.$state.ended()&&this.aa(this.g.duration,t),this._.f("duration-change",{detail:this.g.duration,trigger:t})}Fa(t){this._.f("volume-change",{detail:{volume:this.g.volume,muted:this.g.muted},trigger:t})}Ca(t){this.aa(this.g.currentTime,t),this._.f("seeked",{detail:this.g.currentTime,trigger:t}),Math.trunc(this.g.currentTime)===Math.trunc(this.g.duration)&&n(this.g.duration)>n(this.g.currentTime)&&(this.aa(this.g.duration,t),this.g.ended||this.l.player.dispatch(new l("media-play-request",{trigger:t})))}Da(t){this._.f("seeking",{detail:this.g.currentTime,trigger:t})}va(t){this._.f("progress",{detail:{buffered:this.g.buffered,seekable:this.g.seekable},trigger:t})}Ka(){y(this.g.controls)&&(this.g.controls=!1),this.l.player.dispatch(new l("media-loop-request"))}xa(t){this._.f("suspend",{trigger:t})}Ba(t){this._.f("rate-change",{detail:this.g.playbackRate,trigger:t})}p(t){const i=this.g.error;i&&this._.f("error",{detail:{message:i.message,code:i.code,mediaError:i},trigger:t})}}class v{constructor(t,i){this.ga=t,this.O=i,this.Ma.onaddtrack=this.Oa.bind(this),this.Ma.onremovetrack=this.Pa.bind(this),this.Ma.onchange=this.Qa.bind(this),h(this.O.audioTracks,"change",this.Ra.bind(this))}get Ma(){return this.ga.media.audioTracks}Oa(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.O.audioTracks[e.C](s,t),i.enabled&&(s.selected=!0)}Pa(t){const i=this.O.audioTracks.getById(t.track.id);i&&this.O.audioTracks[e.Sa](i,t)}Qa(t){let i=this.Na();if(!i)return;const s=this.O.audioTracks.getById(i.id);s&&this.O.audioTracks[e.B](s,!0,t)}Na(){return Array.from(this.Ma).find(t=>t.enabled)}Ra(t){const{current:i}=t.detail;if(!i)return;const s=this.Ma.getTrackById(i.id);if(s){const r=this.Na();r&&(r.enabled=!1),s.enabled=!0}}}class w{constructor(t){this.scope=k(),this.h=null,this.g=t}setup(t){new T(this,t),"audioTracks"in this.media&&new v(this,t),this.playsinline=t.$state.playsinline(),d(()=>{this.g.setAttribute("src",""),this.g.load()})}get type(){return""}get media(){return this.g}get currentSrc(){return this.h}get paused(){return this.g.paused}get muted(){return this.g.muted}set muted(t){this.g.muted=t}get volume(){return this.g.volume}set volume(t){this.g.volume=t}get currentTime(){return this.g.currentTime}set currentTime(t){this.g.currentTime=t}get playsinline(){return this.g.hasAttribute("playsinline")}set playsinline(t){$(this.g,"playsinline",t)}get playbackRate(){return this.g.playbackRate}set playbackRate(t){this.g.playbackRate=t}async play(){return this.g.play()}async pause(){return this.g.pause()}async loadSource({src:t,type:i},s){this.g.preload=s||"",m(t)?this.g.srcObject=t:(this.g.srcObject=null,this.g.src=_(t)?t:window.URL.createObjectURL(t)),this.g.load(),this.h={src:t,type:i}}}export{w as H,u as R};
