import{M as u,q as W,h as p,l as S,E as w,D as c,N as m}from"./vidstack-f5f427f7.js";function E(i,t="preconnect"){const s=document.querySelector(`link[href="${i}"]`);if(!u(s))return!0;const e=document.createElement("link");return e.rel=t,e.href=i,e.crossOrigin="true",document.head.append(e),!0}const d={};function k(i){if(d[i])return d[i].promise;const t=W(),s=document.querySelector(`script[src="${i}"]`);if(!u(s))return t.resolve(),t.promise;const e=document.createElement("script");return e.src=i,e.onload=()=>{t.resolve(),delete d[i]},e.onerror=()=>{t.reject(),delete d[i]},setTimeout(()=>document.head.append(e),0),t.promise}function g(i){return i==="use-credentials"?"include":p(i)?"same-origin":void 0}const C=Symbol(0),F=Symbol(0),R=Symbol(0),V=Symbol(0),j=Symbol(0),x=Symbol(0),$=Symbol(0),n={Ta:C,F,Ua:R,Va:V,G:j,R:x,S:$};function O(i,t){for(let s=0,e=i.length;s<e;s++)if(l(i[s],t))return i[s];return null}function l(i,t){return t>=i.startTime&&t<i.endTime}function X(i,t,s){let e=null;function a(){const r=p(t)?[t]:t,h=i.toArray().find(o=>r.includes(o.kind)&&o.mode==="showing");if(h!==e){if(!h){s(null);return}h.readyState==2?s(h):(s(null),h.addEventListener("load",()=>s(h),{once:!0})),e=h}}return a(),S(i,"mode-change",a)}var f,b,y;class Y extends w{constructor(t){super(),this.id="",this.label="",this.language="",this.default=!1,this.Va=!1,this.Xa=0,this.W="disabled",this._a={},this.Za=[],this.Wa=[],this.Ya=[],this[f]=0,this[b]=null,this[y]=null;for(const s of Object.keys(t))this[s]=t[s];this.type||(this.type="vtt"),t.content?import("https://cdn.jsdelivr.net/npm/media-captions@next/dist/prod.js").then(({parseText:s,VTTCue:e,VTTRegion:a})=>{t.type==="json"?this.$a(t.content,e,a):s(t.content,{type:t.type}).then(({cues:r,regions:h})=>{this.Wa=r,this.Za=h,this.F()})}):t.src||(this[n.F]=2)}static createId(t){return`id::${t.type}-${t.kind}-${t.src??t.label}`}get metadata(){return this._a}get regions(){return this.Za}get cues(){return this.Wa}get activeCues(){return this.Ya}get readyState(){return this[n.F]}get mode(){return this.W}set mode(t){this.setMode(t)}addCue(t,s){let e=0,a=this.Wa.length;for(e=0;e<a&&!(t.endTime<=this.Wa[e].startTime);e++);e===a?this.Wa.push(t):this.Wa.splice(e,0,t),s?.type!=="cuechange"&&this[n.R]?.track.addCue(t),this.dispatchEvent(new c("add-cue",{detail:t,trigger:s})),l(t,this.Xa)&&this[n.Ua](this.Xa,s)}removeCue(t,s){const e=this.Wa.indexOf(t);if(e>=0){const a=this.Ya.includes(t);this.Wa.splice(e,1),this[n.R]?.track.removeCue(t),this.dispatchEvent(new c("remove-cue",{detail:t,trigger:s})),a&&this[n.Ua](this.Xa,s)}}setMode(t,s){this.W!==t&&(this.W=t,t==="disabled"?(this.Ya=[],this.ab()):this.readyState===2?this[n.Ua](this.Xa,s):this.bb(),this.dispatchEvent(new c("mode-change",{detail:this,trigger:s})),this[n.G]?.())}[(f=n.F,b=n.G,y=n.R,n.Ua)](t,s){if(this.Xa=t,this.mode==="disabled"||!this.Wa.length)return;const e=[];for(let r=0,h=this.Wa.length;r<h;r++){const o=this.Wa[r];l(o,t)&&e.push(o)}let a=e.length!==this.Ya.length;if(!a){for(let r=0;r<e.length;r++)if(!this.Ya.includes(e[r])){a=!0;break}}this.Ya=e,a&&this.ab(s)}[n.Va](){this.Va=!0,this.W!=="disabled"&&this.bb()}async bb(){if(!(!this.Va||!this.src||this[n.F]>0)){this[n.F]=1,this.dispatchEvent(new c("load-start"));try{const{parseResponse:t,VTTCue:s,VTTRegion:e}=await import("https://cdn.jsdelivr.net/npm/media-captions@next/dist/prod.js"),a=this[n.Ta]?.(),r=fetch(this.src,{headers:this.type==="json"?{"Content-Type":"application/json"}:void 0,credentials:g(a)});if(this.type==="json")this.$a(await(await r).text(),s,e);else{const{errors:h,metadata:o,regions:T,cues:v}=await t(r,{type:this.type,encoding:this.encoding});if(h[0]?.code===0)throw h[0];this._a=o,this.Za=T,this.Wa=v}this.F()}catch(t){this.cb(t)}}}F(){if(this[n.F]=2,!this.src||this.type!=="vtt"){const s=this[n.R]?.track;if(s)for(const e of this.Wa)s.addCue(e)}const t=new c("load");this[n.Ua](this.Xa,t),this.dispatchEvent(t)}cb(t){this[n.F]=3,this.dispatchEvent(new c("error",{detail:t}))}$a(t,s,e){try{t=JSON.parse(t),t.regions&&(this.Za=t.regions.map(a=>Object.assign(new e,a))),t.cues&&(this.Wa=t.cues.filter(a=>m(a.startTime)&&m(a.endTime)).map(a=>Object.assign(new s(0,0,""),a)))}catch(a){this.cb(a)}}ab(t){this.dispatchEvent(new c("cue-change",{trigger:t}))}}const U=/captions|subtitles/;function A(i){return U.test(i.kind)}export{n as T,Y as a,l as b,O as f,g,A as i,k as l,X as o,E as p};
