import{o as h,l as a,D as p,x as g}from"../chunks/vidstack-f5f427f7.js";import{l as u,m as d,f as P}from"../chunks/vidstack-fdaf7abf.js";import{H as f}from"../chunks/vidstack-8cb01b64.js";import{a as v,T as r}from"../chunks/vidstack-284499df.js";class k{constructor(t,e){this.n=t,this.O=e,t.textTracks.onaddtrack=this.P.bind(this),h(this.Q.bind(this))}P(t){const e=t.track;if(!e||m(this.n,e))return;const i=new v({id:e.id,kind:e.kind,label:e.label,language:e.language,type:"vtt"});i[r.R]={track:e},i[r.F]=2,i[r.S]=!0;let n=0;const o=l=>{if(e.cues)for(let c=n;c<e.cues.length;c++)i.addCue(e.cues[c],l),n++};o(t),e.oncuechange=o,this.O.textTracks.add(i,t),i.setMode(e.mode,t)}Q(){this.n.textTracks.onaddtrack=null;for(const t of this.O.textTracks){const e=t[r.R]?.track;e?.oncuechange&&(e.oncuechange=null)}}}function m(s,t){return Array.from(s.children).find(e=>e.track===t)}class x{constructor(t,e){this.T=(i,n)=>{this.g.delegate.f("picture-in-picture-change",{detail:i,trigger:n})},this.n=t,this.g=e,a(this.n,"enterpictureinpicture",this.U.bind(this)),a(this.n,"leavepictureinpicture",this.V.bind(this))}get active(){return document.pictureInPictureElement===this.n}get supported(){return u(this.n)}async enter(){return this.n.requestPictureInPicture()}exit(){return document.exitPictureInPicture()}U(t){this.T(!0,t)}V(t){this.T(!1,t)}}class T{constructor(t,e){this.W="inline",this.n=t,this.g=e,a(this.n,"webkitpresentationmodechanged",this.G.bind(this))}get Z(){return d(this.n)}async Y(t){this.W!==t&&this.n.webkitSetPresentationMode(t)}G(){const t=this.W;this.W=this.n.webkitPresentationMode,this.g.player?.dispatch(new p("video-presentation-change",{detail:this.W,trigger:event})),["fullscreen","picture-in-picture"].forEach(e=>{(this.W===e||t===e)&&this.g.delegate.f(`${e}-change`,{detail:this.W===e,trigger:event})})}}class y{constructor(t){this.X=t}get active(){return this.X.W==="fullscreen"}get supported(){return this.X.Z}async enter(){this.X.Y("fullscreen")}async exit(){this.X.Y("inline")}}class b{constructor(t){this.X=t}get active(){return this.X.W==="picture-in-picture"}get supported(){return this.X.Z}async enter(){this.X.Y("picture-in-picture")}async exit(){this.X.Y("inline")}}class w extends f{constructor(t,e){super(t),this.$$PROVIDER_TYPE="VIDEO",g(()=>{if(d(t)){const i=new T(t,e);this.fullscreen=new y(i),this.pictureInPicture=new b(i)}else u(t)&&(this.pictureInPicture=new x(t,e))},this.scope)}get type(){return"video"}setup(t){super.setup(t),P(this.video)&&new k(this.video,t),t.textRenderers.j(this.video),h(()=>{t.textRenderers.j(null)}),this.type==="video"&&t.delegate.f("provider-setup",{detail:this})}get video(){return this.g}}export{w as VideoProvider};
